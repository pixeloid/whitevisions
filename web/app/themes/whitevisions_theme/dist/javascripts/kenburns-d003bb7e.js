/*
 * Jquery Kenburns Image Gallery
 * Original author: John [at] Toymakerlabs
 * Further changes, comments: [at]Toymakerlabs
 * Licensed under the MIT license
 * 
 * Copyright (c) 2013 ToymakerLabs

 * Permission is hereby granted, free of charge, to any person obtaining a copy of this software 
 * and associated documentation files (the "Software"), to deal in the Software without restriction,
 * including without limitation the rights to use, copy, modify, merge, publish, distribute, 
 * sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is 
 * furnished to do so, subject to the following conditions: The above copyright notice and this 
 * permission notice shall be included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, 
 * INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR 
 * PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY 
 * CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 *
*/
!function(t,e,s,n){function o(e,i){this.element=e,this.options=t.extend({},h,i),this._defaults=h,this._name=r,this.maxSlides=this.options.images.length,this.init()}function a(){var t,i=s.createElement("p"),o={WebkitTransform:"-webkit-transform",MozTransform:"-moz-transform"};s.body.insertBefore(i,null);for(var a in o)i.style[a]!==n&&(i.style[a]="translate3d(1px,1px,1px)",t=e.getComputedStyle(i).getPropertyValue(o[a]));return s.body.removeChild(i),t!==n&&t.length>0&&"none"!==t}var r="Kenburns",h={images:[],duration:400,fadeSpeed:500,scale:1,ease3d:"cubic-bezier(.81, 0, .26, 1)",onLoadingComplete:function(){},onSlideComplete:function(){},onListComplete:function(){},getSlideIndex:function(){return l}},d={},l=0;o.prototype.init=function(){var e=this.options.images;this.width=t(this.element).width(),this.height=t(this.element).height(),this.has3d=a();for(i in e)d["image"+i]={},d["image"+i].loaded=!1,this.attachImage(e[i],"image"+i,i);var s=t("<div/>");s.addClass("loader"),s.css({position:"absolute","z-index":1e4}),t(this.element).prepend(s)},o.prototype.attachImage=function(e,i,s){var n=this,o=t("<div/>");o.attr("class","kb-slide"),o.css({opacity:0});var a=t("<img />");a.attr("src",e),a.attr("alt",i),o.html(a),this.has3d&&(a.css({"-webkit-transform-origin":"left top"}),a.css({"-moz-transform-origin":"left top"}),a.css({"-webkit-transform":"scale("+n.options.scale+") translate3d(0,0,0)"}),a.css({"-moz-transform":"scale("+n.options.scale+") translate3d(0,0,0)"})),this.doTransition=this.has3d?this.transition3d:this.transition,a.load(function(){d["image"+s].element=this,d["image"+s].loaded=!0,d["image"+s].width=t(this).width(),d["image"+s].width=t(this).height(),n.insertAt(s,o),n.resume(s)})},o.prototype.resume=function(e){0==e&&(this.startTransition(0),t(this.element).find(".loader").hide()),e==this.holdup&&(t("#status").html(""),t(this.element).find(".loader").hide(),this.startTransition(this.holdup)),1==this.checkLoadProgress()&&(t(this.element).find(".stalled").each(function(){t(this).css({opacity:1,"z-index":1}),t(this).removeClass("stalled")}),this.options.onLoadingComplete())},o.prototype.checkLoadProgress=function(){var t=!0;for(i=0;i<this.maxSlides;i++)0==d["image"+i].loaded&&(t=!1);return t},o.prototype.wait=function(){clearInterval(this.interval),t("#status").html("loading"),t(this.element).find(".loader").show();var e=d["image"+(l-1)].element;t(e).parent().stop(!0,!0),t(e).parent().addClass("stalled")},o.prototype.startTransition=function(t){var e=this;l=t,e.doTransition(),this.interval=setInterval(function(){l<e.maxSlides-1?l++:l=0,0==d["image"+l].loaded?(e.holdup=l,e.wait()):e.doTransition()},this.options.duration)},o.prototype.chooseCorner=function(){var e=this.options.scale,i=d["image"+l].element,s=i.height/i.width,n=Math.floor(t(this.element).width()*(1/e)),o=Math.floor(t(this.element).width()*s*(1/e));t(i).width(n),t(i).height(o);var a=t(this.element).width(),r=t(this.element).height(),h=[{x:0,y:0},{x:1,y:0},{x:0,y:1},{x:1,y:1}],p=Math.floor(4*Math.random()),m=h[p];h.splice(p,1);var c=h[Math.floor(3*Math.random())],f={startX:m.x*(a-n*e),startY:m.y*(r-o*e),endX:c.x*(a-n),endY:c.y*(r-o)};return f},o.prototype.transition3d=function(){var e=this,i=this.options.scale,s=d["image"+l].element,n=this.chooseCorner();t(s).css({"-webkit-transition":"none"}),t(s).css({"-moz-transition":"none"}),t(s).css({"-webkit-transform":"scale("+i+") translate3d("+n.startX+"px,"+n.startY+"px,0)"}),t(s).css({"-moz-transform":"scale("+i+") translate3d("+n.startX+"px,"+n.startY+"px,0)"}),t(s).parent().css({opacity:0,"z-index":"3"}),t(s).parent().animate({opacity:1},e.options.fadeSpeed),t(s).css({"-webkit-transition":"-webkit-transform "+(e.options.duration+e.options.fadeSpeed)+"ms "+e.options.ease3d}),t(s).css({"-moz-transition":"-moz-transform "+(e.options.duration+e.options.fadeSpeed)+"ms "+e.options.ease3d}),t(s).css({"-webkit-transform":"scale(1) translate3d("+n.endX+"px,"+n.endY+"px,0)"}),t(s).css({"-moz-transform":"scale(1) translate3d("+n.endX+"px,"+n.endY+"px,0)"}),this.transitionOut(),this.options.onSlideComplete()},o.prototype.transition=function(){var e=this,i=this.options.scale,s=d["image"+l].element,n=t(s).width(),o=t(s).height(),a=this.chooseCorner();t(s).css({left:a.startX,top:a.startY,width:n*i,height:o*i}),t(s).animate({left:a.endX,top:a.endY,width:n,height:o},e.options.duration+e.options.fadeSpeed),t(s).parent().css({opacity:0,"z-index":3}),t(s).parent().animate({opacity:1},e.options.fadeSpeed),this.transitionOut(),this.options.onSlideComplete()},o.prototype.transitionOut=function(){var e=this,i=d["image"+l].element;t(i).parent().delay(e.options.duration).animate({opacity:0},e.options.fadeSpeed,function(){t(this).css({"z-index":1})})},o.prototype.insertAt=function(e,i){var s=t(this.element).children().size();0>e&&(e=Math.max(0,s+1+e));t(this.element).append(i);s>e&&t(this.element).children().eq(e).before(t(this.element).children().last())},t.fn[r]=function(e){return this.each(function(){t.data(this,"plugin_"+r)||t.data(this,"plugin_"+r,new o(this,e))})}}(jQuery,window,document);